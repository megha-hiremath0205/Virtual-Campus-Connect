<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Navigator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #0a1929;
        }
        #canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 10;
            background: rgba(10, 25, 41, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 20px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header p {
            font-size: 12px;
            color: #88c0ff;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            z-index: 10;
            background: rgba(10, 25, 41, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 400px;
        }
        .controls h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #88c0ff;
        }
        .control-item {
            font-size: 12px;
            margin: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .mouse-icon { background: #4a90e2; }
        .key-icon { background: #e24a4a; }
        .sidebar {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            z-index: 10;
            background: rgba(10, 25, 41, 0.9);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            min-width: 250px;
        }
        .sidebar h2 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        .sidebar p {
            font-size: 12px;
            color: #88c0ff;
            margin-bottom: 15px;
        }
        .building-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }
        .building-info h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #88c0ff;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="header">
        <h1>üèõÔ∏è Campus Navigator</h1>
        <p>Professional campus layout</p>
        <p style="font-size: 11px; margin-top: 5px;">Hover buildings to inspect ‚Äî left-drag to rotate, scroll to zoom</p>
    </div>

    <div class="controls">
        <h3>Controls:</h3>
        <div class="control-item">
            <div class="control-icon mouse-icon">üñ±Ô∏è</div>
            <span>Left click + drag: Rotate view (360¬∞)</span>
        </div>
        <div class="control-item">
            <div class="control-icon mouse-icon">üñ±Ô∏è</div>
            <span>Scroll: Zoom in/out</span>
        </div>
        <div class="control-item">
            <div class="control-icon mouse-icon">üñ±Ô∏è</div>
            <span>Hover: Inspect buildings (rise up + highlight)</span>
        </div>
        <div class="control-item">
            <div class="control-icon key-icon">R</div>
            <span>Press R to reset top-down view</span>
        </div>
        <div class="control-item">
            <div class="control-icon key-icon">D</div>
            <span>Press D to toggle debug overlay ‚Äî shows camera & rotation values</span>
        </div>
    </div>

    <div class="sidebar">
        <h2>Building Details</h2>
        <p>Select a building</p>
        <div id="buildingInfo"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, raycaster, mouse;
        let buildings = [];
        let isDragging = false;
        let prevMouseX = 0;
        let prevMouseY = 0;
        let cameraAngle = { theta: 0, phi: Math.PI / 4 };
        let cameraDistance = 15;
        let hoveredBuilding = null;
        let showDebug = false;

        const buildingData = [
            { name: 'HOD', color: 0x87ceeb, position: [4, 0, -5], size: [2, 2.5, 2] },
            { name: 'Block 3', color: 0x7fffd4, position: [-3, 0, 1], size: [2, 1.2, 2] },
            { name: 'Block 4', color: 0xffd700, position: [4, 0, 1], size: [2.5, 1.2, 2.5] },
            { name: 'Block 2', color: 0x9fb6ff, position: [-3, 0, 5], size: [2, 1.2, 2] },
            { name: 'Block 1', color: 0xffb6c1, position: [4, 0, 5], size: [2, 1.2, 2] }
        ];

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a1929);
            scene.fog = new THREE.Fog(0x0a1929, 10, 30);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.left = -10;
            directionalLight.shadow.camera.right = 10;
            directionalLight.shadow.camera.top = 10;
            directionalLight.shadow.camera.bottom = -10;
            scene.add(directionalLight);

            // Ground/Roads
            const roadGroup = new THREE.Group();
            
            // Main intersection
            const mainRoad1 = new THREE.Mesh(
                new THREE.PlaneGeometry(20, 3),
                new THREE.MeshStandardMaterial({ color: 0x666666, roughness: 0.9 })
            );
            mainRoad1.rotation.x = -Math.PI / 2;
            mainRoad1.receiveShadow = true;
            roadGroup.add(mainRoad1);

            const mainRoad2 = new THREE.Mesh(
                new THREE.PlaneGeometry(3, 20),
                new THREE.MeshStandardMaterial({ color: 0x666666, roughness: 0.9 })
            );
            mainRoad2.rotation.x = -Math.PI / 2;
            mainRoad2.receiveShadow = true;
            roadGroup.add(mainRoad2);

            // Ground
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(30, 30),
                new THREE.MeshStandardMaterial({ color: 0x1a3a52, roughness: 1 })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.01;
            ground.receiveShadow = true;
            scene.add(ground);
            
            scene.add(roadGroup);

            // Buildings
            buildingData.forEach(data => {
                const building = createBuilding(data);
                buildings.push(building);
                scene.add(building);
            });

            updateCameraPosition();
            setupEventListeners();
            animate();
        }

        function createBuilding(data) {
            const group = new THREE.Group();
            
            const geometry = new THREE.BoxGeometry(data.size[0], data.size[1], data.size[2]);
            const material = new THREE.MeshStandardMaterial({ 
                color: data.color,
                roughness: 0.7,
                metalness: 0.3
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.y = data.size[1] / 2;
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            
            // Add label
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            // Add background for better visibility
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add border
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 4;
            ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
            
            // Add text
            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.name, 256, 64);
            
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true,
                depthTest: false,
                depthWrite: false
            });
            const label = new THREE.Sprite(labelMaterial);
            label.position.y = data.size[1] + 0.8;
            label.scale.set(3, 0.75, 1);
            label.renderOrder = 999;
            
            group.add(mesh);
            group.add(label);
            group.position.set(data.position[0], data.position[1], data.position[2]);
            
            group.userData = { 
                name: data.name, 
                originalColor: data.color,
                originalY: data.position[1],
                mesh: mesh,
                label: label
            };
            
            return group;
        }

        function updateCameraPosition() {
            camera.position.x = cameraDistance * Math.sin(cameraAngle.phi) * Math.cos(cameraAngle.theta);
            camera.position.y = cameraDistance * Math.cos(cameraAngle.phi);
            camera.position.z = cameraDistance * Math.sin(cameraAngle.phi) * Math.sin(cameraAngle.theta);
            camera.lookAt(0, 0, 0);
        }

        function setupEventListeners() {
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mousedown', onMouseDown);
            window.addEventListener('mouseup', onMouseUp);
            window.addEventListener('wheel', onWheel);
            window.addEventListener('keydown', onKeyDown);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

            if (isDragging) {
                const deltaX = e.clientX - prevMouseX;
                const deltaY = e.clientY - prevMouseY;
                
                cameraAngle.theta -= deltaX * 0.005;
                cameraAngle.phi -= deltaY * 0.005;
                
                // Clamp phi to prevent flipping
                cameraAngle.phi = Math.max(0.1, Math.min(Math.PI - 0.1, cameraAngle.phi));
                
                updateCameraPosition();
                
                prevMouseX = e.clientX;
                prevMouseY = e.clientY;
            }
        }

        function onMouseDown(e) {
            if (e.button === 0) {
                isDragging = true;
                prevMouseX = e.clientX;
                prevMouseY = e.clientY;
            }
        }

        function onMouseUp(e) {
            if (e.button === 0) {
                isDragging = false;
            }
        }

        function onWheel(e) {
            e.preventDefault();
            cameraDistance += e.deltaY * 0.01;
            cameraDistance = Math.max(5, Math.min(30, cameraDistance));
            updateCameraPosition();
        }

        function onKeyDown(e) {
            if (e.key === 'r' || e.key === 'R') {
                // Reset to top-down view
                cameraAngle.theta = 0;
                cameraAngle.phi = Math.PI / 4;
                cameraDistance = 15;
                updateCameraPosition();
            }
            if (e.key === 'd' || e.key === 'D') {
                showDebug = !showDebug;
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            // Raycasting for hover
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(buildings.map(b => b.children[0]));

            // Reset previous hover
            if (hoveredBuilding && (!intersects.length || intersects[0].object !== hoveredBuilding.children[0])) {
                hoveredBuilding.children[0].material.color.setHex(hoveredBuilding.userData.originalColor);
                hoveredBuilding.position.y = hoveredBuilding.userData.originalY;
                hoveredBuilding = null;
                document.getElementById('buildingInfo').innerHTML = '';
            }

            // Apply hover effect
            if (intersects.length > 0) {
                const building = buildings.find(b => b.children[0] === intersects[0].object);
                if (building && building !== hoveredBuilding) {
                    hoveredBuilding = building;
                    building.children[0].material.color.setHex(0xffffff);
                    building.position.y = building.userData.originalY + 0.3;
                    
                    document.getElementById('buildingInfo').innerHTML = `
                        <div class="building-info">
                            <h3>${building.userData.name}</h3>
                            <p style="font-size: 11px; margin-top: 5px;">Click for more details</p>
                        </div>
                    `;
                }
            }

            // Debug overlay
            if (showDebug) {
                const debugText = `Camera: Œ∏=${(cameraAngle.theta * 180 / Math.PI).toFixed(1)}¬∞ œÜ=${(cameraAngle.phi * 180 / Math.PI).toFixed(1)}¬∞ dist=${cameraDistance.toFixed(1)}`;
                if (!document.getElementById('debugOverlay')) {
                    const div = document.createElement('div');
                    div.id = 'debugOverlay';
                    div.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;background:rgba(0,0,0,0.7);padding:10px;border-radius:5px;font-family:monospace;font-size:12px;pointer-events:none;z-index:100;';
                    document.body.appendChild(div);
                }
                document.getElementById('debugOverlay').textContent = debugText;
            } else {
                const overlay = document.getElementById('debugOverlay');
                if (overlay) overlay.remove();
            }

            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
